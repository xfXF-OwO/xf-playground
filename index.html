<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ë“œë˜ê·¸ ì´ë¯¸ì§€ â€” ëª¨ë°”ì¼ íƒ­ í™•ëŒ€/ë§í¬, ì•ˆì „ì˜ì—­ ëŒ€ì‘</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
  }
  html, body{
    margin:0; padding:0; height:100%;
    background:#fff;
    overflow:hidden;
    -webkit-user-select:none; user-select:none;
    touch-action:none; /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤/ì”ìƒ ë°©ì§€ */
  }
  #draggableSection{
    position:relative; width:100vw; height:100vh; overflow:hidden;
    padding-bottom: var(--safe-bottom); /* ì‹œê°ì  ì—¬ìœ  */
  }

  /* ìƒë‹¨ ì²´í¬ í•„í„°(í•­ìƒ ìµœìƒë‹¨) */
  .filter-bar{
    position:fixed; top:10px; left:50%; transform:translateX(-50%);
    z-index:1000000; color:#4d4d4d;
    padding:6px 10px; border-radius:10px; display:flex; gap:14px;
    font:600 12px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
    backdrop-filter: blur(6px);
  }
  .filter-bar label{ display:flex; align-items:center; gap:6px; cursor:pointer; }
  .filter-bar input{ width:14px; height:14px; }

  /* ì•„ì´í…œ(ë°°ê²½ì°½) */
  .draggable-wrapper{
    position:absolute; display:flex; align-items:center;
    user-select:none; cursor:grab; z-index:10;
    -webkit-user-drag:none; touch-action:none;
    max-width:none;
    transition: transform .2s ease, opacity .2s ease;
  }
  .draggable-wrapper.grabbing{ cursor:grabbing; }

  .thumb{
    position:relative; width:100%; display:inline-block;
    filter: drop-shadow(0 20px 44px rgba(0,0,0,.28))
            drop-shadow(0 4px 10px rgba(0,0,0,.22));
  }

  /* í”„ë ˆì„: PNG ë°°ê²½, ë¹„ìœ¨ì€ CSS ë³€ìˆ˜ë¡œ í†µì¼ */
  .frame{
    width:100%;
    aspect-ratio: var(--frame-ar, 1200/1000);
    background: var(--frame-bg) center/100% 100% no-repeat;
    position:relative;
  }

  /* í”„ë ˆì„ ë‚´ë¶€ ì•ˆì „ì˜ì—­(ìƒë‹¨ë°”/í•˜ë‹¨ ê·¸ë¦¼ì í”¼í•˜ê¸°) */
  .art{
    position:absolute;
    inset: var(--inset-top,15%) var(--inset-right,10%)
           var(--inset-bottom,10%) var(--inset-left,10%);
    display:flex; align-items:center; justify-content:center;
    overflow:hidden; pointer-events:none;
  }
  .art img{
    max-width:100%; max-height:100%;
    width:auto; height:auto; display:block;
    -webkit-user-drag:none; user-drag:none; pointer-events:none;
  }

  /* ì½”ë„ˆ ë¦¬ì‚¬ì´ì¦ˆ í•«ì˜ì—­(ë°ìŠ¤í¬í†± ì „ìš©) */
  .resize-corner{
    position:absolute; right:0; bottom:0; width:18px; height:18px;
    pointer-events:auto; background:transparent;
  }

  /* ëª¨ë°”ì¼ íƒ­ í™•ëŒ€ ìƒíƒœ */
  .zoomed{
    position:fixed !important;
    left:50% !important; top:calc(50% + var(--safe-top)/2) !important;
    transform: translate(-50%, -50%) !important;
    width:92vw !important; /* í™”ë©´ ëŒ€ë¶€ë¶„ */
    z-index:1000001 !important;
    cursor:default !important;
  }
  .zoomed .resize-corner{ display:none !important; }

  /* í™•ëŒ€ ì‹œ ë°°ê²½ íƒ­ ì°¨ë‹¨ìš© ë°±ë“œë¡­(íˆ¬ëª…) */
  .zoom-backdrop{
    position:fixed; inset:0; z-index:1000000;
    background: transparent;
  }

  /* êµ¬ë©(ë°ìŠ¤í¬í†±ì—ì„œë§Œ) */
  .hole-area{
    position:absolute; bottom:10px; right:40px;
    font-size:140px; pointer-events:none; z-index:5;
  }
</style>
</head>
<body>
  <div id="draggableSection">
    <div class="filter-bar">
      <label><input type="checkbox" data-filter="png"> PNG</label>
      <label><input type="checkbox" data-filter="gif"> GIF</label>
      <label><input type="checkbox" data-filter="link"> LINK</label>
    </div>
    <div class="hole-area">ğŸ•³ï¸</div>
  </div>

<script>
(() => {
  const section = document.getElementById('draggableSection');
  const hole = document.querySelector('.hole-area');

  /* ===== ì„¤ì • ===== */
  const FRAME_SRC = 'https://i.imgur.com/Sgwt5Hy.png';
  const IS_TOUCH = matchMedia('(hover:none) and (pointer:coarse)').matches;
  const UNIFY_W  = IS_TOUCH ? '22vw' : '10vw';   // ëª¨ë°”ì¼ì€ ì‹œì‘ í¬ê¸° ì—…
  const PAD_RATIO = 0.06;
  const ALLOW_OVERLAP = 8;
  const RELAX_PASSES  = 30;

  // ëª¨ë°”ì¼ì—ì„œëŠ” êµ¬ë© ì œê±°
  if (IS_TOUCH && hole) hole.remove();

  // ì•ˆì „ì˜ì—­(px) ì½ê¸°
  function px(v){ return parseFloat(String(v||'0').replace('px',''))||0; }
  function safeInsets(){
    const cs = getComputedStyle(document.documentElement);
    return {
      top: px(cs.getPropertyValue('--safe-top')),
      bottom: px(cs.getPropertyValue('--safe-bottom')),
    };
  }

  // ì´ë¯¸ì§€ ëª©ë¡
  const imageSources = [
    "https://imgur.com/N0TBWZP","https://imgur.com/jZc9E5a","https://imgur.com/d41PtBI",
    "https://imgur.com/qBOCOTT","https://imgur.com/Cl9eFr5","https://imgur.com/ijesB8N",
    "https://imgur.com/dRIwmfM","https://i.imgur.com/4giNzpA.gif","https://imgur.com/rdRSnS1",
    "https://imgur.com/WGeDvn2","https://imgur.com/6wzn6e3","https://imgur.com/1rvAWro",
    "https://imgur.com/tKIIpBq","https://i.imgur.com/qPu22yR.gif","https://imgur.com/tzJYned",
    "https://i.imgur.com/Dku5N18.gif","https://imgur.com/zM8d6tk","https://imgur.com/E5n1OcX",
    "https://imgur.com/bShUtJp","https://imgur.com/4TUJn6x","https://imgur.com/YIMvYed",
    "https://imgur.com/SqjbaNc","https://imgur.com/RUGNwRk","https://imgur.com/aEIP80D",
    "https://imgur.com/emwcull","https://imgur.com/gjj4zas"
  ];

  // ë§í¬ ë§¤í•‘
  const linkMap = {
    'ijesB8N':'https://marpple.shop/kr/xfworksforxfworld',
    'dRIwmfM':'https://www.instagram.com/xf_works/',
    '1rvAWro':'https://www.instagram.com/xf_works/',
    'bShUtJp':'https://www.instagram.com/xf_works/',
    'Dku5N18':'https://www.instagram.com/senseiwillfixit/'
  };

  // â˜… GIF ê°•ì œ ì¸ì‹ ì„¸íŠ¸(í™•ì¥ì ì—†ëŠ” Imgur í‚¤ìš©)
  const GIF_KEYS = new Set(['jZc9E5a']);

  // ===== ìœ í‹¸ =====
  const clamp=(v,min,max)=>Math.max(min,Math.min(v,max));
  function ptr(e){
    const p=('touches' in e && e.touches[0]) ? e.touches[0] : (('changedTouches' in e && e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : e);
    const r=section.getBoundingClientRect();
    return { x:p.clientX-r.left, y:p.clientY-r.top, clientX:p.clientX, clientY:p.clientY };
  }
  function normUrl(u){
    let src=u.trim();
    if(!src.includes('i.imgur.com')) src=src.replace('imgur.com/','i.imgur.com/');
    if(!/\.(png|jpg|jpeg|gif)$/i.test(src)) src+='.png'; // í™•ì¥ì ì—†ìœ¼ë©´ pngë¡œ
    return src;
  }

  // ì´ˆê¸° ëœë¤ ë°°ì¹˜(ì•ˆì „ì˜ì—­ ê³ ë ¤)
  function initialRandom(wraps){
    const W=section.clientWidth, H=section.clientHeight, inset=safeInsets();
    const padX=W*PAD_RATIO, padY=H*PAD_RATIO;
    wraps.forEach(el=>{
      const w=el.offsetWidth, h=el.offsetHeight;
      const spanW=Math.max(1, W - padX*2 - w);
      const spanH=Math.max(1, H - padY*2 - inset.bottom - h);
      const x = padX + Math.random()*spanW;
      const y = padY + Math.random()*spanH;
      el.style.left = x+'px';
      el.style.top  = y+'px';
    });
  }

  // ê²¹ì¹¨ ì™„í™”
  function relax(wraps, passes=RELAX_PASSES, allow=ALLOW_OVERLAP){
    const W=section.clientWidth, H=section.clientHeight, n=wraps.length, inset=safeInsets();
    for(let p=0;p<passes;p++){
      let moved=false;
      for(let i=0;i<n;i++){
        const a=wraps[i], ar={x:a.offsetLeft,y:a.offsetTop,w:a.offsetWidth,h:a.offsetHeight};
        for(let j=i+1;j<n;j++){
          const b=wraps[j], br={x:b.offsetLeft,y:b.offsetTop,w:b.offsetWidth,h:b.offsetHeight};
          if(ar.x < br.x+br.w && ar.x+ar.w > br.x && ar.y < br.y+br.h && ar.y+ar.h > br.y){
            const ox = Math.min(ar.x+ar.w - br.x, br.x+br.w - ar.x);
            const oy = Math.min(ar.y+ar.h - br.y, br.y+br.h - ar.y);
            if(ox<=0 || oy<=0) continue;
            if(ox < oy){
              const push = Math.max(0, ox - allow)/2 + 0.5;
              const dir  = (ar.x < br.x) ? -1 : 1;
              ar.x = clamp(ar.x + dir*push, 0, W-ar.w);
              br.x = clamp(br.x - dir*push, 0, W-br.w);
            }else{
              const push = Math.max(0, oy - allow)/2 + 0.5;
              const dir  = (ar.y < br.y) ? -1 : 1;
              ar.y = clamp(ar.y + dir*push, 0, H-inset.bottom-ar.h);
              br.y = clamp(br.y - dir*push, 0, H-inset.bottom-br.h);
            }
            a.style.left = ar.x+'px'; a.style.top = ar.y+'px';
            b.style.left = br.x+'px'; b.style.top = br.y+'px';
            moved=true;
          }
        }
        // ê°€ì¥ìë¦¬ ë°˜ë°œ(ì•ˆì „ì˜ì—­ ê³ ë ¤)
        const margin=6;
        if(ar.x < margin)        { ar.x = margin; a.style.left=ar.x+'px'; moved=true; }
        if(ar.y < margin)        { ar.y = margin; a.style.top =ar.y+'px'; moved=true; }
        if(ar.x+ar.w > W-margin) { ar.x = W-margin-ar.w; a.style.left=ar.x+'px'; moved=true; }
        if(ar.y+ar.h > H-inset.bottom-margin){
          ar.y = H-inset.bottom-margin-ar.h; a.style.top = ar.y+'px'; moved=true;
        }
      }
      if(!moved) break;
    }
  }

  function layoutVisible(){
    const vis = items.filter(el=>el.style.display!=='none');
    if(!vis.length) return;
    initialRandom(vis);
    relax(vis);
  }

  // í”„ë ˆì„ ë¹„ìœ¨ ì…‹ì—… í›„ ë¹Œë“œ
  const frameImg = new Image();
  frameImg.src = FRAME_SRC;
  frameImg.onload = () => {
    const fw = frameImg.naturalWidth || 1200;
    const fh = frameImg.naturalHeight || 1000;
    const root = document.documentElement;
    root.style.setProperty('--frame-ar', `${fw} / ${fh}`);
    root.style.setProperty('--frame-bg', `url("${FRAME_SRC}")`);
    buildAll();
  };

  // ëª¨ë°”ì¼ í™•ëŒ€ìš© ë°±ë“œë¡­
  let zoomBackdrop = null, backdropArmedAt = 0;
  function ensureBackdrop(){
    if(!zoomBackdrop){
      zoomBackdrop = document.createElement('div');
      zoomBackdrop.className = 'zoom-backdrop';
      zoomBackdrop.style.pointerEvents = 'none'; // ì´ˆê¸° íƒ­ ë¬´ì‹œ
      setTimeout(()=>{ zoomBackdrop && (zoomBackdrop.style.pointerEvents='auto'); }, 200); // 200ms í›„ í™œì„±í™”
      zoomBackdrop.addEventListener('click', () => {
        const z = document.querySelector('.draggable-wrapper.zoomed');
        if(z) unzoom(z);
      }, {passive:true});
    }
    return zoomBackdrop;
  }
  function zoom(wrap){
    document.body.appendChild(ensureBackdrop());
    backdropArmedAt = Date.now();
    wrap.classList.add('zoomed');
  }
  function unzoom(wrap){
    wrap.classList.remove('zoomed');
    if(zoomBackdrop && zoomBackdrop.parentNode) zoomBackdrop.parentNode.removeChild(zoomBackdrop);
    zoomBackdrop = null;
  }

  const items=[];
  function buildAll(){
    // ì…”í”Œ
    for(let i=imageSources.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[imageSources[i],imageSources[j]]=[imageSources[j],imageSources[i]];}

    imageSources.forEach(raw=>{
      const src=normUrl(raw);
      const file=src.split('/').pop();
      const key=file.split('.')[0];
      const urlExt=(file.split('.').pop()||'').toLowerCase();
      const isGif = urlExt==='gif' || GIF_KEYS.has(key);
      const dataExt = isGif ? 'gif' : 'png';

      const wrap=document.createElement('div');
      wrap.className='draggable-wrapper';
      wrap.dataset.ext=dataExt; if(linkMap[key]) wrap.dataset.link='1';
      wrap.style.setProperty('width', UNIFY_W, 'important'); // ì‹œì‘ í­(ë“œë˜ê·¸ ë¦¬ì‚¬ì´ì¦ˆë¡œ ë³€ê²½ ê°€ëŠ¥)

      const frame=document.createElement('div'); frame.className='frame';
      const art=document.createElement('div');   art.className='art';
      const img=document.createElement('img');   img.src=src; img.alt=key; img.draggable=false;
      const corner=document.createElement('div'); corner.className='resize-corner';

      art.appendChild(img); frame.append(art,corner); wrap.append(frame); section.appendChild(wrap);
      items.push(wrap);

      // ---------- ë“œë˜ê·¸ ----------
      let dragging=false, offX=0, offY=0, moved=0;
      const down=e=>{
        if(wrap.classList.contains('zoomed')) return;    // í™•ëŒ€ ì¤‘ì—” ë“œë˜ê·¸ ê¸ˆì§€
        if(!IS_TOUCH && isNearCorner(wrap,e)) return;    // ë°ìŠ¤í¬í†± ì½”ë„ˆëŠ” ë¦¬ì‚¬ì´ì¦ˆì— ë§¡ê¹€
        dragging=true; wrap.classList.add('grabbing'); wrap.style.zIndex=100+(Date.now()%100000);
        const p=ptr(e); offX=p.x-wrap.offsetLeft; offY=p.y-wrap.offsetTop; moved=0;
        e.preventDefault();
      };
      const move=e=>{
        if(!dragging && !resizing){
          if(!IS_TOUCH) wrap.style.cursor=isNearCorner(wrap,e)?'nwse-resize':(wrap.classList.contains('grabbing')?'grabbing':'grab');
          return;
        }
        if(dragging){
          const p=ptr(e);
          let nx=p.x-offX, ny=p.y-offY;
          const inset=safeInsets();
          const maxX=Math.max(0, section.clientWidth-wrap.offsetWidth);
          const maxY=Math.max(0, section.clientHeight-inset.bottom-wrap.offsetHeight);
          nx=clamp(nx,0,maxX); ny=clamp(ny,0,maxY);
          moved += Math.abs(nx-wrap.offsetLeft) + Math.abs(ny-wrap.offsetTop);
          wrap.style.left=nx+'px'; wrap.style.top=ny+'px';
          e.preventDefault();
        }
      };
      const up=e=>{
        if(dragging){
          wrap.classList.remove('grabbing'); dragging=false;
          const isClick = moved<=4;
          if(isClick){
            if(IS_TOUCH){
              const hasLink = !!linkMap[key];
              if(!wrap.classList.contains('zoomed')){
                zoom(wrap); // ì²« íƒ­: í™•ëŒ€
              }else{
                if(hasLink){
                  if(confirm('êµ¬ê²½í•˜ëŸ¬ ë‹¤ë…€ì˜µë‹ˆë‹¤ğŸšª')) window.location.href = linkMap[key];
                  else unzoom(wrap);
                }else{
                  unzoom(wrap);
                }
              }
            }else{
              // ë°ìŠ¤í¬í†±: í´ë¦­ ì‹œ ë§í¬ ì´ë™(ìˆì„ ë•Œë§Œ)
              if(linkMap[key]) window.location.href = linkMap[key];
            }
          }
        }
        if(resizing){ resizing=false; document.body.style.cursor=''; }
      };
      wrap.addEventListener('mousedown',down);
      document.addEventListener('mousemove',move);
      document.addEventListener('mouseup',up);
      wrap.addEventListener('touchstart',down,{passive:false});
      document.addEventListener('touchmove',move,{passive:false});
      document.addEventListener('touchend',up);

      // ---------- ë¦¬ì‚¬ì´ì¦ˆ(ë°ìŠ¤í¬í†± ì „ìš©, í­ë§Œ ë³€ê²½) ----------
      let resizing=false, startX=0, baseW=0;
      function isNearCorner(el,ev){
        const r=el.getBoundingClientRect(), t=18;
        const x=('touches'in ev && ev.touches[0])?ev.touches[0].clientX:ev.clientX;
        const y=('touches'in ev && ev.touches[0])?ev.touches[0].clientY:ev.clientY;
        return (x>=r.right-t && y>=r.bottom-t);
      }
      wrap.addEventListener('mousedown', e=>{
        if(IS_TOUCH) return; // í„°ì¹˜ ê¸°ê¸°ì—ì„œëŠ” ë¦¬ì‚¬ì´ì¦ˆ ë¹„í™œì„±
        if(wrap.classList.contains('zoomed')) return;
        if(!isNearCorner(wrap,e)) return;
        resizing=true; startX=e.clientX; baseW=wrap.offsetWidth; document.body.style.cursor='nwse-resize'; e.preventDefault();
      });
      document.addEventListener('mousemove', e=>{
        if(!resizing) return;
        const dx=e.clientX-startX; const nw=Math.max(120, baseW+dx); // ìµœì†Œ 120px, ìµœëŒ€ ì—†ìŒ
        wrap.style.setProperty('width', nw+'px', 'important');
        const inset=safeInsets();
        const maxX=Math.max(0, section.clientWidth-wrap.offsetWidth);
        const maxY=Math.max(0, section.clientHeight-inset.bottom-wrap.offsetHeight);
        wrap.style.left = clamp(wrap.offsetLeft,0,maxX)+'px';
        wrap.style.top  = clamp(wrap.offsetTop ,0,maxY)+'px';
      });
    });

    // ì²« ë ˆì´ì•„ì›ƒ
    requestAnimationFrame(() => { layoutVisible(); });

    // í•„í„° (data-ext / data-link ê¸°ì¤€) â†’ jZc9E5aë„ GIFë¡œ ì˜ ê±¸ë¦¼
    const checks=[...document.querySelectorAll('.filter-bar input')];
    function applyFilter(){
      const on=new Set(checks.filter(c=>c.checked).map(c=>c.dataset.filter));
      const all = on.size===0;
      const vis=[];
      items.forEach(w=>{
        const key=(w.querySelector('img').src.split('/').pop().split('.')[0]);
        const ext=(w.dataset.ext||'').toLowerCase();
        const hasLink=!!linkMap[key];
        let v = all || (on.has('png')&&ext==='png') || (on.has('gif')&&ext==='gif') || (on.has('link')&&hasLink);
        w.style.display=v?'block':'none';
        w.style.pointerEvents=v?'':'none';
        if(v) vis.push(w);
      });
      requestAnimationFrame(()=>{ layoutVisible(); });
    }
    checks.forEach(c=>c.addEventListener('change',applyFilter));

    // ë·°í¬íŠ¸/íˆ´ë°” ë³€ë™ ì‹œ(ëª¨ë°”ì¼ ì£¼ì†Œì°½ ë†’ì´ ë³€í™” í¬í•¨) ì¬í´ë¨í”„
    window.addEventListener('resize', ()=>{ requestAnimationFrame(layoutVisible); }, {passive:true});
  }

  // í”„ë ˆì„ ë¹„ìœ¨ ì…‹ì—…
  const frameProbe = new Image();
  frameProbe.src = FRAME_SRC;
  frameProbe.onload = () => {
    const fw = frameProbe.naturalWidth || 1200;
    const fh = frameProbe.naturalHeight || 1000;
    const root = document.documentElement;
    root.style.setProperty('--frame-ar', `${fw} / ${fh}`);
    root.style.setProperty('--frame-bg', `url("${FRAME_SRC}")`);
    buildAll();
  };
})();
</script>
</body>
</html>
