<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ë“œë˜ê·¸ ì´ë¯¸ì§€ â€” ëª¨ë°”ì¼ ì”ìƒ ì œê±° + ê³ ë¥¸ ëœë¤ ë°°ì¹˜</title>
<style>
  html, body{
    margin:0; padding:0; height:100%;
    background: aliceblue;
    overflow:hidden;
    touch-action:none; /* í„°ì¹˜ ìŠ¤í¬ë¡¤/ì¤Œ ë°©ì§€(ë“œë˜ê·¸ ì•ˆì •í™”) */
    -webkit-tap-highlight-color: transparent; /* iOS íƒ­ í•˜ì´ë¼ì´íŠ¸ ì œê±° */
  }
  *{
    -webkit-user-select:none; user-select:none;
    -webkit-touch-callout:none;
  }
  img, .draggable-wrapper, .thumb, .thumb .art{
    -webkit-user-drag:none; user-drag:none; /* iOS ë“œë˜ê·¸ ê³ ìŠ¤íŠ¸ ì°¨ë‹¨ */
  }

  #draggableSection{
    position:relative; width:100vw; height:100vh; overflow:hidden;
  }

  /* ìƒë‹¨ ì²´í¬ í•„í„° (íˆ¬ë°•í•œ ì²´í¬ë°•ìŠ¤) */
  .filter-bar{
    position:absolute; top:10px; left:50%; transform:translateX(-50%);
    z-index:1000; color:#4d4d4d;
    padding:6px 10px; border-radius:10px; display:flex; gap:14px;
    font:600 12px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
    backdrop-filter: blur(6px);
    background: rgba(255,255,255,.35);
    border: 1px solid rgba(0,0,0,.08);
  }
  .filter-bar label{ display:flex; align-items:center; gap:6px; cursor:pointer; }
  .filter-bar input{ width:14px; height:14px; }

  /* ì•„ì´í…œ */
  .draggable-wrapper{
    position:absolute; display:flex; align-items:center; user-select:none;
    cursor:grab; z-index:10;
    width:var(--item-size-default, 10vw);
    will-change: transform, left, top; /* ë“œë˜ê·¸ ì¤‘ ë¶€ë“œëŸ½ê²Œ */
  }
  .draggable-wrapper.grabbing{ cursor:grabbing; }

  .thumb{
    position:relative; width:100%; display:inline-block; max-width: 75%;
    /* ë§¥ ì°½ ëŠë‚Œì˜ ê·¸ë¦¼ì */
    filter: drop-shadow(0 18px 40px rgba(0,0,0,.30)) drop-shadow(0 3px 10px rgba(0,0,0,.22));
  }
  .thumb .frame{ width:100%; height:auto; display:block; pointer-events:none; }

  /* í”„ë ˆì„ ë‚´ë¶€ ì•ˆì „ì˜ì—­ */
  .thumb .art{
    position:absolute;
    --inset-top:15%; --inset-right:10%; --inset-bottom:10%; --inset-left:10%;
    top:var(--inset-top); right:var(--inset-right);
    bottom:var(--inset-bottom); left:var(--inset-left);
    display:flex; align-items:center; justify-content:center;
    overflow:hidden; pointer-events:none; background:transparent;
  }
  .thumb .art img{ max-width:100%; max-height:100%; width:auto; height:auto; display:block; }

  /* ë³´ì´ì§€ ì•ŠëŠ” ì½”ë„ˆ ë¦¬ì‚¬ì´ì¦ˆ í•«ì˜ì—­ */
  .resize-corner{
    position:absolute; right:0; bottom:0; width:18px; height:18px;
    pointer-events:auto; background:transparent;
  }

  /* ì œê±°ìš© êµ¬ë© */
  .hole-area{
    position:absolute; bottom:10px; right:40px;
    font-size:140px; pointer-events:none; z-index:5;
  }

  /* ===== ê°œë³„ í­ ì˜¤ë²„ë¼ì´ë“œ(í•„ìš” ì‹œ ì¡°ì •) ===== */
  .img-N0TBWZP{width:15vw}.img-jZc9E5a{width:12vw}.img-d41PtBI{width:8vw}
  .img-qBOCOTT{width:18vw}.img-Cl9eFr5{width:10vw}.img-ijesB8N{width:20vw}
  .img-dRIwmfM{width:9.5vw}.img-4giNzpA{width:12vw}.img-rdRSnS1{width:12vw}
  .img-WGeDvn2{width:12vw}.img-6wzn6e3{width:25vw}.img-1rvAWro{width:15.5vw}
  .img-tKIIpBq{width:11vw}.img-qPu22yR{width:20vw}.img-tzJYned{width:15.5vw}
  .img-Dku5N18{width:7vw}.img-zM8d6tk{width:10vw}.img-E5n1OcX{width:10vw}
  .img-bShUtJp{width:24vw}.img-4TUJn6x{width:10vw}.img-YIMvYed{width:10vw}
  .img-SqjbaNc{width:18vw}.img-RUGNwRk{width:22vw}.img-aEIP80D{width:18vw}
  .img-emwcull{width:15vw}.img-gjj4zas{width:12vw}

  /* ====== í™•ëŒ€ ì˜¤ë²„ë ˆì´ ====== */
  #zoomOverlay{
    position:fixed; inset:0; background:rgba(0,0,0,.6);
    display:none; align-items:center; justify-content:center;
    z-index:2000;
  }
  #zoomOverlay.show{ display:flex; }
  #zoomOverlay img{
    max-width: min(90vw, 1200px);
    max-height: 90vh;
    width:auto; height:auto; display:block;
    box-shadow: 0 16px 36px rgba(0,0,0,.4), 0 2px 8px rgba(0,0,0,.3);
    border-radius: 6px;
  }

  /* ====== í™•ì¸ ëª¨ë‹¬ ====== */
  #confirmModal{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:2100;
  }
  #confirmModal.show{ display:flex; }
  .dialog{
    background:#fff; color:#222; border-radius:12px; min-width:260px; max-width:80vw;
    box-shadow: 0 12px 30px rgba(0,0,0,.28);
    padding:18px 16px;
    font: 500 14px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  }
  .dialog p{ margin: 4px 4px 14px; white-space:nowrap; }
  .buttons{ display:flex; gap:10px; justify-content:flex-end; }
  .buttons button{
    border:none; border-radius:8px; padding:9px 14px; cursor:pointer; font-weight:600;
  }
  .buttons .yes{ background:#222; color:#fff; }
  .buttons .no{ background:#ececec; color:#222; }
</style>
</head>
<body>
  <div id="draggableSection">
    <!-- ì²´í¬ í•„í„° -->
    <div class="filter-bar">
      <label><input type="checkbox" data-filter="png"> PNG</label>
      <label><input type="checkbox" data-filter="gif"> GIF</label>
      <label><input type="checkbox" data-filter="link"> LINK</label>
    </div>
    <div class="hole-area">ğŸ•³ï¸</div>
  </div>

  <!-- í™•ëŒ€ ì˜¤ë²„ë ˆì´ -->
  <div id="zoomOverlay"><img id="zoomImg" src="" alt=""></div>

  <!-- í™•ì¸ ëª¨ë‹¬ -->
  <div id="confirmModal">
    <div class="dialog">
      <p>êµ¬ê²½í•˜ëŸ¬ ë‹¤ë…€ì˜µë‹ˆë‹¤ğŸšª</p>
      <div class="buttons">
        <button class="no" id="confirmNo">ì•„ë‹ˆì˜¤</button>
        <button class="yes" id="confirmYes">ì˜ˆ</button>
      </div>
    </div>
  </div>

<script>
(() => {
  const section = document.getElementById('draggableSection');
  const hole = document.querySelector('.hole-area');
  const FRAME_SRC = 'https://i.imgur.com/Sgwt5Hy.png';

  const imageSources = [
    "https://imgur.com/N0TBWZP","https://imgur.com/jZc9E5a","https://imgur.com/d41PtBI",
    "https://imgur.com/qBOCOTT","https://imgur.com/Cl9eFr5","https://imgur.com/ijesB8N",
    "https://imgur.com/dRIwmfM","https://i.imgur.com/4giNzpA.gif","https://imgur.com/rdRSnS1",
    "https://imgur.com/WGeDvn2","https://imgur.com/6wzn6e3","https://imgur.com/1rvAWro",
    "https://imgur.com/tKIIpBq","https://i.imgur.com/qPu22yR.gif","https://imgur.com/tzJYned",
    "https://i.imgur.com/Dku5N18.gif","https://imgur.com/zM8d6tk","https://imgur.com/E5n1OcX",
    "https://imgur.com/bShUtJp","https://imgur.com/4TUJn6x","https://imgur.com/YIMvYed",
    "https://imgur.com/SqjbaNc","https://imgur.com/RUGNwRk","https://imgur.com/aEIP80D",
    "https://imgur.com/emwcull","https://imgur.com/gjj4zas"
  ];

  // ë§í¬ ë§¤í•‘
  const linkMap = {
    'ijesB8N':'https://marpple.shop/kr/xfworksforxfworld',
    'dRIwmfM':'https://www.instagram.com/xf_works/',
    '1rvAWro':'https://www.instagram.com/xf_works/',
    'bShUtJp':'https://www.instagram.com/xf_works/',
    'Dku5N18':'https://www.instagram.com/senseiwillfixit/'
  };

  // ì „ì—­: ê¸°ë³¸ ë“œë˜ê·¸(ë¸Œë¼ìš°ì € DnD) ì°¨ë‹¨ -> iOS ê³ ìŠ¤íŠ¸ ì´ë¯¸ì§€ ì œê±°
  document.addEventListener('dragstart', e => e.preventDefault(), {passive:false});

  // ì…”í”Œ
  for(let i=imageSources.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[imageSources[i],imageSources[j]]=[imageSources[j],imageSources[i]];}

  const wraps=[];        // DOM ë˜í¼ë“¤ (í•„í„°/ì´ë²¤íŠ¸ìš©)
  const layoutItems=[];  // {wrap,w,h} ë ˆì´ì•„ì›ƒ ê³„ì‚°ìš©
  let zTop=100;
  const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints>0;

  function normUrl(u){
    let src=u.trim();
    if(!src.includes('i.imgur.com')) src=src.replace('imgur.com/','i.imgur.com/');
    if(!/\.(png|jpg|jpeg|gif)$/i.test(src)) src+='.png';
    return src;
  }
  function clamp(v,min,max){ return Math.max(min, Math.min(v, max)); }

  // í™•ëŒ€ ì˜¤ë²„ë ˆì´ / í™•ì¸ ëª¨ë‹¬
  const zoomOverlay = document.getElementById('zoomOverlay');
  const zoomImg     = document.getElementById('zoomImg');
  const confirmModal= document.getElementById('confirmModal');
  const yesBtn = document.getElementById('confirmYes');
  const noBtn  = document.getElementById('confirmNo');

  let currentZoomLink = null;
  let overlayOpen = false;

  function openZoom(src, link=null){
    currentZoomLink = link || null;
    zoomImg.src = src;
    zoomOverlay.classList.add('show');
    overlayOpen = true;
  }
  function closeZoom(){
    zoomOverlay.classList.remove('show');
    confirmModal.classList.remove('show');
    zoomImg.src = '';
    currentZoomLink = null;
    overlayOpen = false;
  }
  function askGoOut(){ confirmModal.classList.add('show'); }
  zoomOverlay.addEventListener('click', () => {
    if (currentZoomLink) askGoOut();
    else closeZoom();
  });
  yesBtn.addEventListener('click', () => { if (currentZoomLink) window.location.href = currentZoomLink; closeZoom(); });
  noBtn.addEventListener('click', () => { closeZoom(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && overlayOpen){ closeZoom(); }});

  // ìƒì„±
  let readyCount = 0;
  imageSources.forEach(raw=>{
    const src=normUrl(raw);
    const file=src.split('/').pop();
    const key=file.split('.')[0];
    const ext=file.split('.').pop().toLowerCase();

    const wrap=document.createElement('div');
    wrap.className='draggable-wrapper img-'+key;
    wrap.dataset.ext=ext;
    if(linkMap[key]) wrap.dataset.link='1';

    const thumb=document.createElement('div'); thumb.className='thumb';
    const frame=document.createElement('img'); frame.className='frame'; frame.src=FRAME_SRC; frame.alt='frame';
    const art=document.createElement('div'); art.className='art';
    const img=document.createElement('img'); img.src=src; img.alt=key; img.draggable=false;
    const corner=document.createElement('div'); corner.className='resize-corner';

    // ê¸°ë³¸ ë“œë˜ê·¸ ì°¨ë‹¨(ì¶”ê°€ ì•ˆì „)
    img.addEventListener('dragstart', e=>e.preventDefault());

    art.appendChild(img); thumb.append(frame,art,corner); wrap.append(thumb); section.appendChild(wrap);

    frame.addEventListener('load', ()=>{
      // í¬ê¸° ì¸¡ì • í›„, ë‚˜ì¤‘ì— ì¼ê´„ ë°°ì¹˜
      layoutItems.push({wrap, key, ext, w:wrap.offsetWidth, h:wrap.offsetHeight});
      readyCount++;
      if(readyCount===imageSources.length){
        if(isTouch){
          // ëª¨ë°”ì¼: ê¸°ì¡´ ëœë¤ ë°°ì¹˜(ì‚´ì§ ì—¬ë°±ë§Œ)
          randomScatter(layoutItems);
        }else{
          // ì›¹: ê³ ë¥¸ ëœë¤ ë°°ì¹˜
          blueNoiseScatter(layoutItems);
        }
      }
    });

    /* === í¬ì¸í„° ì´ë²¤íŠ¸ë¡œ í†µì¼ (ì”ìƒ ì œê±° + ê²¹ì¹¨ ë“œë˜ê·¸ ë°©ì§€) === */
    let mode = null; // 'drag' | 'resize' | null
    let startX=0, startY=0, startLeft=0, startTop=0, startWidth=0;
    let lastTX=0, lastTY=0; // transform ë¸íƒ€
    const CLICK_THRESHOLD = 4;

    function inCorner(ev){
      const rect=wrap.getBoundingClientRect();
      const thr=18;
      const x = ev.clientX, y = ev.clientY;
      return (x>=rect.right-thr && y>=rect.bottom-thr);
    }

    wrap.addEventListener('pointerdown', (e)=>{
      if (overlayOpen) return;
      wrap.setPointerCapture(e.pointerId);
      wrap.style.zIndex = ++zTop;

      startX = e.clientX; startY = e.clientY;
      startLeft = wrap.offsetLeft; startTop = wrap.offsetTop; startWidth = wrap.offsetWidth;
      lastTX = 0; lastTY = 0;

      if (inCorner(e)){
        mode = 'resize';
        document.body.style.cursor='nwse-resize';
      } else {
        mode = 'drag';
        wrap.classList.add('grabbing');
      }
      e.preventDefault();
    });

    wrap.addEventListener('pointermove', (e)=>{
      if (!wrap.hasPointerCapture(e.pointerId) || !mode) return;

      if (mode === 'drag'){
        // ëª©í‘œ ì ˆëŒ€ ì¢Œí‘œ
        const desiredLeft = startLeft + (e.clientX - startX);
        const desiredTop  = startTop  + (e.clientY - startY);
        const maxX = Math.max(0, section.clientWidth  - wrap.offsetWidth);
        const maxY = Math.max(0, section.clientHeight - wrap.offsetHeight);
        const clampedLeft = clamp(desiredLeft, 0, maxX);
        const clampedTop  = clamp(desiredTop , 0, maxY);

        // transformìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™ (ì—… ë•Œë§Œ left/top ë°˜ì˜)
        lastTX = clampedLeft - startLeft;
        lastTY = clampedTop  - startTop;
        wrap.style.transform = `translate3d(${lastTX}px, ${lastTY}px, 0)`;

        // êµ¬ë© ì•ˆì—ì„œë§Œ 50% íˆ¬ëª…
        const holeRect = hole.getBoundingClientRect();
        const inside = (e.clientX>=holeRect.left && e.clientX<=holeRect.right && e.clientY>=holeRect.top && e.clientY<=holeRect.bottom);
        wrap.style.opacity = inside ? '0.5' : '1';

      } else if (mode === 'resize'){
        const dx = e.clientX - startX;
        let newW = Math.max(120, startWidth + dx);
        wrap.style.width = newW + 'px';

        // ë¦¬ì‚¬ì´ì¦ˆ ì¤‘ ê²½ê³„ í´ë¨í”„
        const maxX = Math.max(0, section.clientWidth  - wrap.offsetWidth);
        const maxY = Math.max(0, section.clientHeight - wrap.offsetHeight);
        const cl = clamp(wrap.offsetLeft, 0, maxX);
        const ct = clamp(wrap.offsetTop , 0, maxY);
        wrap.style.left = cl + 'px';
        wrap.style.top  = ct + 'px';
      }
    });

    wrap.addEventListener('pointerup', (e)=>{
      if (!mode) return;
      const moved = Math.abs(e.clientX-startX)+Math.abs(e.clientY-startY);
      const wasClick = moved <= CLICK_THRESHOLD;

      if (mode === 'drag'){
        // transformì„ ì‹¤ì œ ì¢Œí‘œë¡œ ì»¤ë°‹
        const finalLeft = startLeft + lastTX;
        const finalTop  = startTop  + lastTY;
        wrap.style.transform = '';
        wrap.style.left = finalLeft + 'px';
        wrap.style.top  = finalTop  + 'px';
        wrap.classList.remove('grabbing');
        wrap.style.opacity='1';

        // ë“œë¡­-íˆ¬-í™€ (ë“œë˜ê·¸ì¼ ë•Œë§Œ)
        const holeRect = hole.getBoundingClientRect();
        const inside = (e.clientX>=holeRect.left && e.clientX<=holeRect.right && e.clientY>=holeRect.top && e.clientY<=holeRect.bottom);
        if (!wasClick && inside){
          wrap.style.transition='opacity .22s ease, transform .22s ease';
          wrap.style.opacity='0'; wrap.style.transform='scale(.1)';
          setTimeout(()=>wrap.remove(),220);
        }
      }

      // í´ë¦­: í™•ëŒ€ â†’ (ë§í¬ ìˆìœ¼ë©´) ì˜¤ë²„ë ˆì´ì—ì„œ í™•ì¸ í›„ ì´ë™
      if (wasClick){
        const link = linkMap[key] || null;
        openZoom(img.src, link);
      }

      mode = null;
      document.body.style.cursor='';
      wrap.releasePointerCapture(e.pointerId);
    });

    wraps.push(wrap);
  });

  /* ======= ë°°ì¹˜ ì•Œê³ ë¦¬ì¦˜ ======= */

  // ëª¨ë°”ì¼: ê°„ë‹¨ ëœë¤(ì—¬ë°± í¬í•¨)
  function randomScatter(items){
    const W = section.clientWidth, H = section.clientHeight;
    const padX = W*0.05, padY = H*0.05;
    items.forEach(it=>{
      const w = it.wrap.offsetWidth, h = it.wrap.offsetHeight;
      const spanW = Math.max(1, W - padX*2 - w);
      const spanH = Math.max(1, H - padY*2 - h);
      const x = padX + Math.random()*spanW;
      const y = padY + Math.random()*spanH;
      it.wrap.style.left = x+'px';
      it.wrap.style.top  = y+'px';
    });
  }

  // ì›¹: ì§€í„° ê·¸ë¦¬ë“œ + ê°€ë²¼ìš´ ì¶©ëŒ ì™„í™”
  function blueNoiseScatter(items){
    const W = section.clientWidth, H = section.clientHeight;
    const n = items.length;
    const cols = Math.ceil(Math.sqrt(n * (W/H)));
    const rows = Math.ceil(n / cols);
    const cellW = W/cols, cellH = H/rows;

    // ì…€ ì„¼í„° í›„ë³´ ìƒì„± (ì•½ê°„ ì§€í„°)
    const centers = [];
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const cx = (c + 0.5 + (Math.random()-0.5)*0.4) * cellW;
        const cy = (r + 0.5 + (Math.random()-0.5)*0.4) * cellH;
        centers.push({x:cx, y:cy});
      }
    }
    // ì„ê³ , ì•„ì´í…œ í° ê²ƒ(ë©´ì )ë¶€í„° ë°°ì¹˜
    centers.sort(()=>Math.random()-0.5);
    const sorted = [...items].sort((a,b)=>(b.w*b.h)-(a.w*a.h));

    sorted.forEach((it,i)=>{
      const pos = centers[i % centers.length];
      const w = it.wrap.offsetWidth, h = it.wrap.offsetHeight;
      let x = clamp(pos.x - w/2, 0, W - w);
      let y = clamp(pos.y - h/2, 0, H - h);
      it.wrap.style.left = x+'px';
      it.wrap.style.top  = y+'px';
    });

    // ê°„ë‹¨í•œ ì™„í™” 2~3íšŒ: ê²¹ì¹˜ë©´ ë°˜ì”© ë°€ì–´ëƒ„
    const passes = 3;
    for(let p=0;p<passes;p++){
      for(let i=0;i<n;i++){
        for(let j=i+1;j<n;j++){
          const a = items[i].wrap.getBoundingClientRect();
          const b = items[j].wrap.getBoundingClientRect();
          // ê°™ì€ ë¶€ëª¨ë¼ ì¢Œí‘œê³„ ë™ì¼(ë·°í¬íŠ¸ ê¸°ì¤€) â†’ section ê¸°ì¤€ìœ¼ë¡œ ì¬ê³„ì‚°
          const ar = {x: items[i].wrap.offsetLeft, y: items[i].wrap.offsetTop, w:a.width, h:a.height};
          const br = {x: items[j].wrap.offsetLeft, y: items[j].wrap.offsetTop, w:b.width, h:b.height};

          if (ar.x < br.x+br.w && ar.x+ar.w > br.x && ar.y < br.y+br.h && ar.y+ar.h > br.y){
            // ê²¹ì¹¨ â†’ ê°€ë²¼ìš´ ë¶„ë¦¬
            const overlapX = Math.min(ar.x+ar.w - br.x, br.x+br.w - ar.x);
            const overlapY = Math.min(ar.y+ar.h - br.y, br.y+br.h - ar.y);
            if (overlapX < overlapY){
              const dx = overlapX/2 + 2;
              const dir = (ar.x < br.x) ? -1 : 1;
              const ax = clamp(ar.x + dir*dx, 0, W - ar.w);
              const bx = clamp(br.x - dir*dx, 0, W - br.w);
              items[i].wrap.style.left = ax+'px';
              items[j].wrap.style.left = bx+'px';
            } else {
              const dy = overlapY/2 + 2;
              const dir = (ar.y < br.y) ? -1 : 1;
              const ay = clamp(ar.y + dir*dy, 0, H - ar.h);
              const by = clamp(br.y - dir*dy, 0, H - br.h);
              items[i].wrap.style.top = ay+'px';
              items[j].wrap.style.top = by+'px';
            }
          }
        }
      }
    }
  }

  /* ======= í•„í„° ======= */
  const checks = Array.from(document.querySelectorAll('.filter-bar input'));
  function applyFilter(){
    const on = new Set(checks.filter(c=>c.checked).map(c=>c.dataset.filter));
    const showAll = on.size===0;
    wraps.forEach(w=>{
      const ext=(w.dataset.ext||'').toLowerCase();
      const hasLink=w.dataset.link==='1';
      let visible=showAll;
      if(!showAll){
        if(on.has('png') && ext==='png') visible=true;
        if(on.has('gif') && ext==='gif') visible=true;
        if(on.has('link') && hasLink)   visible=true;
      }
      w.style.display=visible?'block':'none';
      w.style.pointerEvents=visible?'':'none';
    });
  }
  checks.forEach(c=>c.addEventListener('change',applyFilter));
})();
</script>
</body>
</html>
